{%- extends 'base.html' -%}
{%- from 'macros.html' import format_output -%}
{%- block title -%}{{ slug }}{% endblock %}
{%- block content -%}

<h2><a href="/">Dataset Hoster</a> : {{ slug }}</h2>
<h4>{{ desc }}</h4>
<p>
   {{ introduction }}
   (<a href="{{ json_url }}">JSON version</a> {% if json_post %}and <a href="#json-post">JSON POST data</a>{% endif %})
</p>

<form action="/{{ slug }}">
  {% for input in inputs %}
     <label for="{{ input }}">{{ input }}</label>
     <input type="text"
            id="{{ input }}"
            name="{{ input }}"
            placeholder="{% if input[0] == '[' %}list of items{% else %}single value{% endif %}"
            value="{{args[input] | escape }}"><br>
  {% endfor %}
  <input type="submit" value="run query">
</form>

{% if error %}
  <p>An error occurred:</p>
  <div>
    <pre>{{ error }} </pre>
  </div>
{% endif %}

{% if recording_mbids %}
  <div style="float: right">
    <a class="button" target="_blank"
       href="https://listenbrainz.org/player/?recording_mbids={{ recording_mbids }}">Open results as a playlist</a>
  </div>
{% endif %}

<div>
  {% for result in results %}
    {% if result.type == "markup" %}
      {{ result.data }}
    {% elif result.type == "dataset" %}
      {{ format_output(result) }}
    {% else %}
      <p><b>INVALID OUTPUT TYPE: PLEASE FIX! (RENDERING AS IS FOR NOW)</b></p>
      {{ result }}
    {% endif %}
  {% endfor %}

  {% if json_post %}
    <div style="padding-top: 3em">
      <small>JSON POST data for this query:</small>
      <div id="json-post">
        <pre style="background-color: #FFF">{{ json_post }}</pre>
      </div>
    </div>
  {% endif %}
</div>

{% block scripts %}
{% endblock %}
