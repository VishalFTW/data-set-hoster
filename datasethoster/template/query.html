{%- extends 'base.html' -%}
{%- from 'macros.html' import format_output -%}
{%- block title -%}{{ slug }}{% endblock %}
{%- block content -%}

<h2><a href="/">Dataset Hoster</a> : {{ slug }}</h2>
<h4>{{ desc }}</h4>
<p>
   {{ introduction | safe }}
   (<a href="{{ json_url }}">JSON version</a> {% if json_post %}and <a href="#json-post">JSON POST data</a>{% endif %})
</p>

<form action="/{{ slug }}">
  {% for field in fields %}
     {% set input = field.name %}
     <label for="{{ input }}">{{ input }}</label>
     <input type="{% if field is datetime_field %}datetime-local{% else %}text{% endif %}"
            id="{{ input }}"
            name="{{ input }}"
            placeholder="single value"
            value="{{args[input] | escape }}"><br>
  {% endfor %}
  <input type="submit" value="run query">
</form>

{% if error %}
  <p>An error occurred:</p>
  <div>
    <pre>{{ error }} </pre>
  </div>
{% endif %}

<div>
  {% for result in results %}
    {% if result["no_table"] %}
      {% for row in result["data"] %}
        {{ row["line"] }}
      {% endfor %}
    {% else %}
      {{ format_output(result, additional_data) }}
    {% endif %}
  {% endfor %}

  {% if json_post %}
    <div style="padding-top: 3em">
      <small>JSON POST data for this query:</small>
      <div id="json-post">
        <pre style="background-color: #FFF">{{ json_post }}</pre>
      </div>
    </div>
  {% endif %}
</div>

{% endblock %}

{% block scripts %}
{% endblock %}
